<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-3d.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <script src="https://code.highcharts.com/modules/drilldown.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>






  <title>Document</title>

  <style>
    /* Styling for the header */
    body {
      background: linear-gradient(to bottom right,  #2c3e50, #ebefce);
    }

    /* Styling for the header */
    #parentele {
      display: flex;
      justify-content: flex-end;
      border: 2px solid yellow;
      height: 580px;
      /* width: 1650px; */

    }

    .header {
      background: linear-gradient(to bottom right, #2c3e50, #dda8d4);
      color: black;
      padding: 10px;
      box-sizing: border-box;
      text-align: center;
    }

    /* Styling for the left side navbar */
    .left-nav {
      position: fixed;
      top: 140px;
      left: 0;
      width: 35%;
      height: 80%;
      background: linear-gradient(to bottom right, #2c3e50, #ebefce);
      color: black;
      padding: 35px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      overflow-y: auto;
      border: 1px solid blue;
      border-radius: 1%;
    }

    /* Styling for the right side navbar */


    /* Styling for the headings in side navbars */
    .left-nav h2 {
      margin: 0;
      padding: 10px 0;
      text-align: center;
    }

    /* Styling for the links in side navbars */
    .left-nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .left-nav li {
      width: 100%;
      margin: 10px 0;
    }

    .left-nav a {
      color: black;
      text-decoration: none;
      width: 100%;
      display: block;
      padding: 10px;
      box-sizing: border-box;
      text-align: center;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .left-nav a:hover {
      background-color: #555;
    }

    #mainele {
      border: 2px solid black;
      height: 580px;
      width: 950px;
      position: fixed;
      top: 140px;
      left: 35%;
      right: 0;
      bottom: 0;
      overflow-x: scroll;
      white-space: nowrap;

    }

    /* Set table width to 100% */
    table {
      width: 100%;
    }

    /* Add some spacing between table cells */
    td,
    th {
      padding: 8px;
    }

    /* Add some borders to table cells */
    td {
      border: 1px solid #097b1c;
    }

    /* Add a gray background color to the header row */
    thead tr {
      background-color: #1013ab;
    }

    /* Add a hover effect to table rows */
    tbody tr:hover {
      background-color: #d40f57e7;
    }

    /* Customize pagination buttons */
    .paginate_button {
      background-color: #e7e7e7;
      border: 1px solid #ddd;
      color: black;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
    }

    .paginate_button:hover {
      background-color: #ddd;
    }

    .paginate_button.current {
      background-color: #4CAF50;
      color: white;
    }

    /* Customize column filter inputs */
    .dataTables_filter input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .dataTables_filter input:focus {
      outline: none;
      box-shadow: 0 0 3px #ddd;
    }

 
    /* Style the table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    /* Style the table headers */
    th {
      background-color: #f2f2f2;
      text-align: left;
      padding: 8px;
      font-size: 16px;
    }

    /* Style the table rows */
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    tr:hover {
      background-color: #ddd;
    }

    /* Style the table cells */
    td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    .box {
      background-color: #f4f0f0;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      transition: box-shadow 0.3s ease;
      width: 400px;
    }

    .box:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }

    .box h2 {
      margin: 0;
    }

    .box2 {
      background-color: #f4f0f0;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      transition: box-shadow 0.3s ease;
      width: 800px;
      margin-left: 450px;
    }

    /* section part */
    section {
      float: left;
      width: 90%;
      margin: 5px;
      padding: 10px;
      border: 1px solid lightgray;
      background-color: #f9f9f9;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      line-height: 1.5;
      color: #333;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #666;
    }

    select {
      padding: 5px;
      margin-bottom: 5px;
      font-size: 16px;
      line-height: 1.5;
      color: #333;
      width: 100%;
    }

    .btn {
      padding: 0.5px;
      margin: 0.5px;
      background-color: #16160b;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: auto;

    }

    .btn:hover {
      background-color: #00d904;
    }
    .btn.active:hover {
  background-color: #00d904;
}

    h2 {
      padding: 10px;
      margin: 10px;
      border: 1px solid black;
      font-size: 24px;
      text-align: center;
      color: #333;
      background-color: #f9f9f9;
    }

    h4 {
      padding: 5px;
      margin: 5px;
      background-color: lightcyan;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      color: #333;
    }



    /* Add media queries for responsive design */
    @media only screen and (max-width: 600px) {

      /* Adjust the table layout for small screens */
      table,
      th,
      td {
        display: block;
        width: 100%;
      }

      th,
      td {
        text-align: center;
      }
    }

    .loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-top-color: #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .summary-table {
  border-collapse: collapse;
  margin: 20px 0;
  font-family: Arial, sans-serif;
  font-size: 14px;
  width: 100%;
}

.summary-table td,
.summary-table th {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
.summary-table-header{
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #3498db;
  text-transform: uppercase;
  color:#ffff;

}
.summary-table tr:nth-child(1) td:nth-child(2) {
  background-color: #262bcd; /* red */
  color: #fff; /* white text color */
}
.summary-table tr:nth-child(1) td:nth-child(3) {
  background-color: #1cdcb9; /* red */
  color: #fff; /* white text color */
}

.summary-table tr:nth-child(2) td:nth-child(n+2) {
  background-color: #ff8080; /* red */
  color: #fff; /* white text color */
}

.summary-table tr:nth-child(2) td:nth-child(n+3) {
  background-color: #ffcc80; /* orange */
}

.summary-table tr:nth-child(2) td:nth-child(n+4) {
  background-color: #26cd31; /* green */
  color: #fff; /* white text color */
}

.summary-header-cell {
  font-weight: bold;
  background-color: #f0f0f0;
  text-transform: uppercase; /* uppercase header text */
  padding: 12px; /* increased padding for header cell */
}

/* Media query for desktop */
/* @media only screen and (min-width: 1200px) { */
  /* Styling for header */
  #parentele {
    /* Update styles for desktop */
    height: 580px;
    width: 100%;
    justify-content: space-between;
  }

  /* Styling for left side navbar */
  .left-nav {
    /* Update styles for desktop */
    top: 140px;
    width: 30%;
    padding: 35px;
  }

  /* Styling for main content */
  #mainele {
    /* Update styles for desktop */
    left: 30%;
    width: 70%;
  }
}

/* Media query for iPad */
@media only screen and (min-width: 768px) and (max-width: 1199px) {
  /* Styling for header */
  #parentele {
    /* Update styles for iPad */
    height: 480px;
    width: 100%;
    justify-content: center;
  }

  /* Styling for left side navbar */
  .left-nav {
    /* Update styles for iPad */
    top: 120px;
    width: 100%;
    padding: 20px;
  }

  /* Styling for main content */
  #mainele {
    /* Update styles for iPad */
    left: 0;
    width: 100%;
    overflow-x: auto;
    white-space: normal;
  }
}




  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <h1>Constituency View</h1>
  </header>
  <nav style="margin-left: 1rem;">
    <button class="btn btn-warning" id="summary-button">Summary</button>
    <button id="stateSatisfaction-btn" class="btn btn-warning">state Satisfaction</button>
    <button class="btn btn-warning" id="mlaSatisfaction-btn">MLA Satisfaction</button>
    <button class="btn btn-warning" id="prefferedparty-btn">Prefferd Party</button>
    <button class="btn btn-warning" id="PrefferMLAcandidate-btn">PREFERRED MLA CANDIDATE</button>
    <button class="btn btn-warning" id="PrefferdMLAByCaste-btn">PREFERRED MLA BY CASTE</button>
    <button class="btn btn-warning" id="PrefferdCMByCaste-btn">CM SATISFACTION BY CASTE</button>
    <button class="btn btn-warning" id="TDPJSPAlliance-btn">TDP JSP ALLIANCE</button>
    <button class="btn btn-warning" id="PrefferYSRCPCoordinator-btn">PREFERRED YSRCP-COORDINATOR</button>
  </nav>
  <div id="parentele">
    <div>
      <nav class="left-nav">
        <h2 style="border: 1px solid black; padding: 10px; margin: 10px;">Constituency View</h2>
        <header>
          <h4 style="background-color:lightcyan; padding: 5px; margin: 5px;">SELECTION</h4>
        </header>
        <section style="margin: 5px;">
          <label for="districtDropdown" style="display: block; margin-bottom: 5px;">DISTRICTS</label>
          <select name="District" id="districtDropdown" style="padding: 5px; margin-bottom: 5px;">
            <option value="">Select a district</option>
          </select>
        </section>
        <section style="margin: 5px;">
          <label for="constituencyDropdown" style="display: block; margin-bottom: 5px;">CONSTITUENCY</label>
          <select name="R_Constituency" id="constituencyDropdown" style="padding: 5px; margin-bottom: 5px;">
            <option value="">Select a constituency</option>
          </select>
        </section>
        <section style="margin: 5px;">
          <label for="weekDropdown" style="display: block; margin-bottom: 5px;">SURVEY DATE</label>
          <select name="Date" id="weekDropdown" style="padding: 5px; margin-bottom: 5px;">
            <option value="">Select a survey date</option>
          </select>
        </section>
        <button id="left-nav-btn" type="button" class="btn btn-primary"
          style="padding: 5px; margin: 5px;">Submit</button>
      </nav>
    </div>

    <div id="mainele"> </div>

  </div>
  <script>
    // get all buttons and add click event listener to each one
const buttons = document.querySelectorAll('.btn');
buttons.forEach(button => {
  button.addEventListener('click', function() {
    // remove 'active' class from all buttons
    buttons.forEach(b => b.classList.remove('active'));
    // add 'active' class to clicked button
    this.classList.add('active');
  });
});


    // Select DOM elements
    const districtDropdown = document.querySelector('#districtDropdown');
    const constituencyDropdown = document.querySelector('#constituencyDropdown');
    const weekDropdown = document.querySelector('#weekDropdown');



    // Event listener for district dropdown
    districtDropdown.addEventListener('change', async function () {
      const selectedDistrict = this.value;

      // Make GET request using Axios
      const response = await axios.get('/constituencies', { params: { district: selectedDistrict } });
      const constituencies = response.data;

      // Populate constituency dropdown
      constituencyDropdown.innerHTML = '<option value="">Select a constituency</option>';
      constituencies.forEach(constituency => {
        const option = document.createElement('option');
        option.value = constituency;
        option.textContent = constituency;
        constituencyDropdown.appendChild(option);
      });
    });

    // Event listener for constituency dropdown
    constituencyDropdown.addEventListener('change', async function () {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = this.value;

      // Make GET request using Axios
      const response = await axios.get('/weeks', { params: { district: selectedDistrict, constituency: selectedConstituency } });
      const weeks = response.data;

      // Populate week dropdown
      weekDropdown.innerHTML = '<option value="">Select a survey date</option>';
      weeks.forEach(week => {
        const option = document.createElement('option');
        option.value = week;
        option.textContent = week;
        weekDropdown.appendChild(option);
      });
    });

    // Initial GET request for districts
    axios.get('/districts')
      .then(response => {
        const districts = response.data;

        // Populate district dropdown
        districtDropdown.innerHTML = '<option value="">Select a district</option>';
        districts.forEach(district => {
          const option = document.createElement('option');
          option.value = district;
          option.textContent = district;
          districtDropdown.appendChild(option);
        });
      })
      .catch(error => {
        console.log(error);
      });

    const submitButton = document.querySelector('#left-nav-btn');
    const resultContainer = document.querySelector('#mainele');
    const stateSatisfaction = document.querySelector('#stateSatisfaction-btn');
    stateSatisfaction.addEventListener('click', renderstateSatisfactionTable);
    while (resultContainer.firstChild) {
      resultContainer.removeChild(resultContainer.firstChild);
    }

    async function renderstateSatisfactionTable(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';

      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);
      try {
// Call the CM_Satisfaction endpoint to get the data
const response1 = await axios.post('/CM_Satisfaction', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
const data1 = response1.data;


// Create the table element
const table1 = document.createElement('table');
table1.style.borderCollapse = 'collapse';
table1.style.width = '100%';

// Create the header row
const headerRow1 = table1.insertRow();
const headerCell1 = headerRow1.insertCell();
headerCell1.textContent = 'Type';
headerCell1.style.border = '1px solid black';
const goodHeaderCell = headerRow1.insertCell();
goodHeaderCell.textContent = 'SATISFIED';
goodHeaderCell.style.border = '1px solid black';
const notGoodHeaderCell = headerRow1.insertCell();
notGoodHeaderCell.textContent = 'NOT SATISFIED';
notGoodHeaderCell.style.border = '1px solid black';

// Add rows for Male, Female, and Total
Object.keys(data1['Good']).forEach((key) => {
  const row = table1.insertRow();
  const rowHeaderCell = row.insertCell();
  rowHeaderCell.textContent = key;
  rowHeaderCell.style.border = '1px solid black';
  const goodCell = row.insertCell();
  goodCell.textContent = data1['Good'][key];
  goodCell.style.border = '1px solid black';
  const notGoodCell = row.insertCell();
  notGoodCell.textContent = data1['Not Good'][key];
  notGoodCell.style.border = '1px solid black';
});

// Add an h1 tag above the table
const h1 = document.createElement('h1');
h1.textContent = 'Satisfaction with STATE Government?';
h1.style.textAlign = 'center';
h1.style.padding = '10px';
h1.style.backgroundColor = 'lightgray';
h1.style.borderRadius = '5px';

        // Add the table to the result container
        // resultContainer.appendChild(table1);

        // Call the TopFiveCast endpoint to get the data
        const response2 = await axios.post('/TopFiveCast', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const data2 = response2.data;

        // Build the second table
        const table2 = document.createElement('table');
        table2.style.borderCollapse = 'collapse';
        table2.style.width = '100%';

        // Create the header row
        const headerRow2 = table2.insertRow();
        const casteHeaderCell = headerRow2.insertCell();
        casteHeaderCell.textContent = 'Caste';
        casteHeaderCell.style.border = '1px solid black';
        const goodPercentageHeaderCell = headerRow2.insertCell();
        goodPercentageHeaderCell.textContent = 'SATISFIED';
        goodPercentageHeaderCell.style.border = '1px solid black';
        const notGoodPercentageHeaderCell = headerRow2.insertCell();
        notGoodPercentageHeaderCell.textContent = 'NOT SATISFIED';
        notGoodPercentageHeaderCell.style.border = '1px solid black';

        // Add a row for each caste
        Object.keys(data2).forEach((caste) => {
          const row = table2.insertRow();
          const casteCell = row.insertCell();
          casteCell.textContent = caste;
          casteCell.style.border = '1px solid black';
          const goodPercentageCell = row.insertCell();
          goodPercentageCell.textContent = data2[caste].SATISFIED;
          goodPercentageCell.style.border = '1px solid black';
          const notGoodPercentageCell = row.insertCell();
          notGoodPercentageCell.textContent = data2[caste]['NOT SATISFIED'];
          notGoodPercentageCell.style.border = '1px solid black';
        });

        // Add the tables to the result container
        // const resultContainer = document.getElementById('mainele');
        // Create the h1 tag and center it
        const h1_2 = document.createElement('h1');
        h1_2.textContent = 'Top 5 Caste’s Satisfaction with STATE Government?';
        h1_2.style.textAlign = 'center';
        h1_2.style.padding = '10px';
        h1_2.style.backgroundColor = 'lightgray';
        h1_2.style.borderRadius = '5px';

        // Add the h1 tag and second table to the result container
        resultContainer.innerHTML = '';
        resultContainer.appendChild(table1);
        resultContainer.insertBefore(h1, table1);
        resultContainer.appendChild(h1_2); // Add the h1 tag before the second table
        resultContainer.appendChild(table2);



      } catch (error) {
        console.log(error);
        const resultContainer = document.getElementById('mainele');
        resultContainer.innerHTML = '<p>Something went wrong. Please try again.</p>';
      }
      finally {
        // Remove the loader from the page
        document.body.removeChild(loader);
      }
    }

    const summaryButton = document.querySelector('#summary-button');
    summaryButton.addEventListener('click', renderSummaryTable);

    async function renderSummaryTable(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);

      try {
  // Call the new SummaryReport endpoint to get the data
  const response = await axios.post('/api/summary-report', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });

  const data = response.data;

  if (Array.isArray(data) && data.length > 0) {
    // Build the table for the summary report
    const table = document.createElement('table');
    table.classList.add('summary-table');

    // Add the first row with column names
    const colNameRow = table.insertRow();
    let cell = colNameRow.insertCell();
    cell.colSpan = '1';
    cell = colNameRow.insertCell();
    cell.textContent = '2019';
    cell.colSpan = '3';
    cell.classList.add('summary-header-cell');
    cell = colNameRow.insertCell();
    cell.textContent = '2014';
    cell.colSpan = '3';
    cell.classList.add('summary-header-cell');
    cell = colNameRow.insertCell();
    cell.textContent = 'Survey Results';
    cell.colSpan = '4';
    cell.classList.add('summary-header-cell');

    // Add the second row with additional column names
    const colNameRow2 = table.insertRow(0); // Add row at index 0 to put it at the top
    cell = colNameRow2.insertCell();
    cell.colSpan = '1';
    cell = colNameRow2.insertCell();
    cell.textContent = 'Past history';
    cell.colSpan = '6';
    cell.classList.add('summary-header-cell');
    cell = colNameRow2.insertCell();
    cell.textContent = 'Which party do you vote for in next MLA Election?';
    cell.colSpan = '4';
    cell.classList.add('summary-header-cell');

    // Create the header row
    const headerRow = table.insertRow();
    for (const key in data[0]) {
      const headerCell = headerRow.insertCell();
      headerCell.textContent = key;
      headerCell.classList.add('summary-header-cell');
    }

    // Add a row for each result
    data.forEach(result => {
      const row = table.insertRow();
      for (const key in result) {
        const cell = row.insertCell();
        cell.textContent = result[key];
      }
    });

    // Clear any previous results and add the new table
    resultContainer.innerHTML = '';
    resultContainer.appendChild(table);

    // Add an h1 tag above the table
    const tableHeader = document.createElement('h1');
    tableHeader.classList.add('summary-table-header');
    tableHeader.textContent = 'Summary Report';
    resultContainer.insertBefore(tableHeader, table);
  } else {
    console.log('Data is not an array or is empty:', data);
    resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
  }
} catch (error) {
  console.error(error);
  resultContainer.innerHTML = '<p>Something went wrong. Please try again.</p>';
}

      finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }


    const MLASatishfactionButton = document.querySelector('#mlaSatisfaction-btn');
    MLASatishfactionButton.addEventListener('click', renderMlasatishfaction);
    async function renderMlasatishfaction(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);

      try {
        // Call the new SummaryReport endpoint to get the data
        const response = await axios.post('/Mlasatishfaction', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });

        const data = response.data;

        if (typeof data === 'object' && Object.keys(data).length > 0) {
  // Build the table for the summary report
  const table = document.createElement('table');
  table.style.borderCollapse = 'collapse';
  table.style.width = '100%';

  // Create the header row
  const headerRow = table.insertRow();
  const typeHeaderCell = headerRow.insertCell();
  typeHeaderCell.textContent = 'Type';
  typeHeaderCell.style.border = '1px solid black';
  const goodHeaderCell = headerRow.insertCell();
  goodHeaderCell.textContent = 'SATISFIED';
  goodHeaderCell.style.border = '1px solid black';
  const notGoodHeaderCell = headerRow.insertCell();
  notGoodHeaderCell.textContent = 'NOT SATISFIED';
  notGoodHeaderCell.style.border = '1px solid black';

  // Add rows for Male, Female, and Total
  Object.keys(data['Good.']).forEach((key) => {
    const row = table.insertRow();
    const rowHeaderCell = row.insertCell();
    rowHeaderCell.textContent = key;
    rowHeaderCell.style.border = '1px solid black';
    const goodCell = row.insertCell();
    goodCell.textContent = data['Good.'][key]  // Add percentage sign
    goodCell.style.border = '1px solid black';
    const notGoodCell = row.insertCell();
    notGoodCell.textContent = data['Not Good.'][key]  // Add percentage sign
    notGoodCell.style.border = '1px solid black';
  });

  // Clear any previous results and add the new table
  resultContainer.innerHTML = '';
  resultContainer.appendChild(table);

  // Add an h1 tag above the table
  const tableHeader = document.createElement('h1');
  tableHeader.textContent = 'Satisfaction with Sitting MLA?';
  resultContainer.insertBefore(tableHeader, table);

          // Call the Castsatisfactionmla endpoint to get the data for the stacked bar chart
          const castResponse = await axios.post('/Castsatisfactionmla', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
          const castData = castResponse.data;


          // Transform the data into an array of objects that Highcharts can use
          const chartData = [];
          Object.keys(castData).forEach(caste => {
            chartData.push({
              name: caste,
              data: [Number(castData[caste].good_percentage.slice(0, -1)), Number(castData[caste].not_good_percentage.slice(0, -1))]
            });
          });

          // Create the chart container if it doesn't exist
          let chartContainer = document.getElementById('chart-container');
          if (!chartContainer) {
            chartContainer = document.createElement('div');
            chartContainer.id = 'chart-container';
           


            resultContainer.appendChild(chartContainer);
          }

          // Use Highcharts to create the stacked bar chart
          Highcharts.chart(chartContainer, {
  chart: {
    type: 'bar',
    backgroundColor: 'transparent'
  },
  title: {
    text: 'Satisfaction with Sitting MLA by Caste',
    style: {
      color: '#fff'
    }
  },
  xAxis: {
    categories: chartData.map(caste => caste.name),
    labels: {
      style: {
        color: '#fff'
      }
    }
  },
  yAxis: {
    title: {
      text: '%',
      style: {
        color: '#fff'
      }
    },
    labels: {
      style: {
        color: '#fff'
      }
    }
  },
  legend: {
    reversed: true,
    itemStyle: {
      color: '#fff'
    }
  },
  plotOptions: {
    series: {
      stacking: 'normal',
      dataLabels: {
        enabled: true,
        format: '{y}%',
        style: {
          color: '#fff'
        }
      }
    }
  },
  series: [{
    name: 'No',
    data: chartData.map(caste => Number(caste.data[1])),
    color: 'rgb(250, 20, 14)'
  }, {
    name: 'Yes',
    data: chartData.map(caste => Number(caste.data[0])),
    color: 'rgb(1, 169, 91)'
  }],
  tooltip: {
    style: {
      color: '#fff'
    }
  }
});
        } else {
          console.log('Data is not an array or is empty:', data);
          resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
        }
      } catch (error) {
        console.error(error);
      }finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }




    // prefferd Pary 
    const prefferdParty = document.querySelector('#prefferedparty-btn');
    prefferdParty.addEventListener('click', renderPrefferdParty);

    async function renderPrefferdParty(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);

      try {
        // Call the PrefferdCaste endpoint to get the data for the stacked bar chart
        const castResponse = await axios.post('/PrefferdCaste', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const castDataa = castResponse.data;
        const castData= castDataa.output 
        const castData2=  castDataa.result1
        console.log(castData2)  


        if (castData && Object.keys(castData).length > 0) {

          // Transform the data into an array of objects that Highcharts can use
          const chartData = Object.keys(castData).map(caste => {
            const casteData = castData[caste];
            return {
              name: caste,
              data: [Number(casteData.YSRCP.slice(0, -1)), Number(casteData.TDP.slice(0, -1)), Number(casteData.JSP_BJP.slice(0, -1)), Number(casteData.Others.slice(0, -1)),
                ]
            };
          });

          // Create the chart container if it doesn't exist
          let chartContainer = document.getElementById('chart-container');
if (!chartContainer) {
  chartContainer = document.createElement('div');
  chartContainer.id = 'chart-container';
  chartContainer.style.display = 'inline-block'; // change display property to inline-block
  chartContainer.style.width = '50%';
  chartContainer.style.height = '100%';
  resultContainer.appendChild(chartContainer);
}

let chartContainer1 = document.getElementById('chart-container1');
if (!chartContainer1) {
  chartContainer1 = document.createElement('div');
  chartContainer1.id = 'chart-container1';
  chartContainer1.style.display = 'inline-block'; // change display property to inline-block
  chartContainer1.style.width = '50%';
  chartContainer1.style.height = '100%';
  resultContainer.appendChild(chartContainer1);
}


          // Use Highcharts to create the stacked bar chart
          Highcharts.chart(chartContainer, {
            chart: {
              type: 'bar',
              // backgroundColor: 'transparent'
            },
            title: {
              text: 'Prefferd Party By Caste'
            },
            xAxis: {
              categories: chartData.map(caste => caste.name)
            },
            yAxis: {
              title: {
                text: '%'
              }
            },
            legend: {
              reversed: true
            },
            plotOptions: {
              series: {
                stacking: 'normal',
                dataLabels: {
                  enabled: true,
                  format: '{y}%',
                  style: {
          color: '#fff'
        }
                }
              }
            },
            series: [
          
            // {
            //   name: 'INC',
            //   data: chartData.map(caste => Number(caste.data[3])),
            //   color: 'rgb(5,99, 193)'
            // },
            // {
            //   name: 'Not Decided',
            //   data: chartData.map(caste => Number(caste.data[4])),
            //   color: 'pink'
            // },
            {
              name: 'Others',
              data: chartData.map(caste => Number(caste.data[3])),
              color: 'rgb(192,192, 192)'
            }, {
              name: 'JSP_BJP',
              data: chartData.map(caste => Number(caste.data[2])),
              color: 'rgb(250,20, 14)'
            },{
              name: 'TDP',
              data: chartData.map(caste => Number(caste.data[1])),
              color: 'rgb(255, 192, 0)'
            }, 
            {
              name: 'YSRCP',
              data: chartData.map(caste => Number(caste.data[0])),
              color: 'rgb(1, 169, 91)'
            }]
          });
           // Calculate total count for result2
        const result2TotalCount = castData2.reduce((total, d) => total + d['totalFactor'], 0);

// Create a pie chart for result2
const result2PieData = castData2.map(d => {
  let color;
  switch (d['Party']) {
    case 'YSRCP':
      color = 'rgb(1, 169, 91)';
      break;
    case 'TDP':
      color = 'rgb(255, 192, 0)';
      break;
    case 'JSP':
      color = 'rgb(250,20, 14)';
      break;
    case 'BJP':
      color = 'rgb(237,125, 49)';
      break;
    case 'INC':
      color = 'rgb(5,99, 193)';
      break;
    case 'Not Decided':
      color = 'rgb(192,192, 192)';
      break;
    default:
      color = 'gray';
  }
  return {
    name: d['Party'],
    y: (d['totalFactor'] / result2TotalCount) * 100,
    color: color
  };
});

Highcharts.chart(chartContainer1, {
  chart: {
    type: 'pie',
    backgroundColor: 'transparent',
    width: 450,
    height: 600
  },
  title: {
    text: 'PREFERRED TOTAL PARTY'
  },
  plotOptions: {
    pie: {
      allowPointSelect: true,
      cursor: 'pointer',
      dataLabels: {
        enabled: true,
        format: '{point.name}: {point.percentage:.0f}%',
        formatter: function() {
          return this.point.name + ': ' + this.point.percentage.toFixed(0) + '%'; // Add percentage directly to the data label
        }
      },
      tooltip: {
        pointFormat: '{point.name}: <b>{point.percentage:.0f}%</b>',
      }
    }
  },
  series: [{
    data: result2PieData
  }]
});


          
        } else {
          console.log('Data is not an object or is empty:', castData);
          resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
        }
      } catch (error) {
        console.error(error);
      }finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }


    // prefferd MLA CANDIDATE
    const PrefferMLAcandidate = document.querySelector('#PrefferMLAcandidate-btn');
    PrefferMLAcandidate.addEventListener('click', renderPrefferMLAcandidate);
      async function renderPrefferMLAcandidate(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      // e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);
      try {
        // Call the PrefferdCaste endpoint to get the data for the pie chart
        const castResponse = await axios.post('/PrefferMLAcandidate', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const castData = castResponse.data;


        if (castData && Object.keys(castData).length > 0) {
  // create an array of objects to store data for the pie chart
  const chartData = [];
  castData.forEach((item) => {
    let color;
    if (item["MLA Preference"] === "Same MLA") {
      color = 'rgb(1, 169, 91)';
    } else if (item["MLA Preference"] === " Other MLA") {
      color = 'rgb(0, 119, 112)';
    } else if (item["MLA Preference"] === "Anyone") {
      color = 'rgb(68, 114, 196)';
    }
    chartData.push({
      name: item["MLA Preference"],
      y: parseFloat(item["totalFactor_percentage"].replace('%', '')),
      color: color // add color property
    });
  });

  //  Create the chart container if it doesn't exist
  let chartContainer = document.getElementById('chart-container');
  if (!chartContainer) {
    chartContainer = document.createElement('div');
    chartContainer.id = 'chart-container';
    resultContainer.appendChild(chartContainer);
  }
  Highcharts.chart(chartContainer, {
    chart: {
      plotBackgroundColor: null,
      plotBorderWidth: null,
      plotShadow: false,
      type: 'pie'
    },
    title: {
      text: 'MLA Preference Chart'
    },
    tooltip: {
      pointFormat: '{series.name}: <b>{point.percentage:.0f}%</b>' // Update pointFormat to remove decimal
    },
    plotOptions: {
      pie: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: {
          enabled: true,
          format: '<b>{point.name}</b>: {point.percentage:.0f} %' // Update format to remove decimal
        }
      }
    },
    series: [{
      name: 'Preference Percentage',
      colorByPoint: true,
      data: chartData
    }],
    colors: [
      'rgb(1, 169, 91)', // Same MLA
      'rgb(0, 119, 112)', // Other MLA
      'rgb(68, 114, 196)' // Anyone
    ]
  });
}
 else {
          console.log('Data is not an object or is empty:', castData);
          resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
        }
      } catch (error) {
        console.error(error);
      }finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }



    // By default cliiekd on summer button and view summary data  into table 
    $(document).ready(function () {
      $("#left-nav-btn").click(function () {
        // your existing code for handling the button click goes here

        // show the summary by default
        $("#summary-button").click();
      });
    })




    const PrefferdMLAByCaste = document.querySelector('#PrefferdMLAByCaste-btn');
    PrefferdMLAByCaste.addEventListener('click', renderPrefferdMLAByCaste);

    async function renderPrefferdMLAByCaste(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);
      try {
        // Call the PrefferdCaste endpoint to get the data for the stacked bar chart
        const castResponse = await axios.post('/PrefferdMLAByCaste', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const castData = castResponse.data;
        console.log(castData);

        if (castData && Object.keys(castData).length > 0) {

          // Transform the data into an array of objects that Highcharts can use
          const chartData = Object.keys(castData).map(caste => {
            const casteData = castData[caste];
            return {
              name: caste,
              data: [

                Number(casteData.SameMLA?.slice(0, -1) ?? 0),
                Number(casteData.OtherMLA?.slice(0, -1) ?? 0),
                Number(casteData.Anyone?.slice(0, -1) ?? 0),
                Number(casteData.Invaid?.slice(0, -1) ?? 0),



              ]
            };
          });

          // Create the chart container if it doesn't exist
          let chartContainer = document.getElementById('chart-container');
          if (!chartContainer) {
            chartContainer = document.createElement('div');
            chartContainer.id = 'chart-container';
            resultContainer.appendChild(chartContainer);
          }

          // Use Highcharts to create the stacked bar chart
          Highcharts.chart(chartContainer, {
            chart: {
              type: 'bar'
            },
            title: {
              text: 'Prefferd Party By Caste'
            },
            xAxis: {
              categories: chartData.map(caste => caste.name)
            },
            yAxis: {
              title: {
                text: '%'
              }
            },
            legend: {
              reversed: true
            },
            plotOptions: {
              series: {
                stacking: 'normal',
                dataLabels: {
                  enabled: true,
                  format: '{y}%'
                }
              }
            },
            series: [{
              name: 'SameMLA',
              data: chartData.map(caste => Number(caste.data[0])),
              color: 'rgb(1, 169, 91)'

            }, {
              name: 'OtherMLA',
              data: chartData.map(caste => Number(caste.data[1])),
              color: 'rgb(0, 119, 112)'
            }, {
              name: 'Anyone',
              data: chartData.map(caste => Number(caste.data[2])),
              color: 'rgb(68, 114, 196)'
            }, {
              name: 'Invalid',
              data: chartData.map(caste => Number(caste.data[3])),
              color: 'blue'
            }
            ]
          });
        } else {
          console.log('Data is not an object or is empty:', castData);
          resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
        }
      } catch (error) {
        console.error(error);
      }finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }

    // Prefferd CM by Caste 
    const PrefferdCMByCaste = document.querySelector('#PrefferdCMByCaste-btn');
    PrefferdCMByCaste.addEventListener('click', renderPrefferdCMByCaste);
    async function renderPrefferdCMByCaste(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";


      document.body.appendChild(loader);
      try {
        // Call the PrefferdCaste endpoint to get the data for the stacked bar chart
        const castResponse = await axios.post('/PrefferdCMByCaste', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const castDataa = castResponse.data;
        const castData= castDataa.output 
        const castData2=  castDataa.result1
        console.log(castData2)  

        if (castData && Object.keys(castData).length > 0) {

          // Transform the data into an array of objects that Highcharts can use
          const chartData = Object.keys(castData).map(caste => {
            const casteData = castData[caste];
            return {
              name: caste,
              data: [Number(casteData.NotGood.slice(0, -1)), Number(casteData.Good.slice(0, -1))]
            };
          });

          // Create the chart container if it doesn't exist
          let chartContainer = document.getElementById('chart-container');
          if (!chartContainer) {
            chartContainer = document.createElement('div');
            chartContainer.id = 'chart-container';
            chartContainer.style.display = 'inline-block'; // change display property to inline-block
            chartContainer.style.width = '50%';
            chartContainer.style.height = '100%';
            resultContainer.appendChild(chartContainer);
          }

          let chartContainer1 = document.getElementById('chart-container1');
          if (!chartContainer1) {
            chartContainer1 = document.createElement('div');
            chartContainer1.id = 'chart-container1';
            chartContainer1.style.display = 'inline-block'; // change display property to inline-block
            chartContainer1.style.width = '50%';
            chartContainer1.style.height = '100%';
            resultContainer.appendChild(chartContainer1);
          }

          // Use Highcharts to create the stacked bar chart
          Highcharts.chart(chartContainer, {
            chart: {
              type: 'bar'
            },
            title: {
              text: 'CM SATISFACTION BY CASTE'
            },
            xAxis: {
              categories: chartData.map(caste => caste.name)
            },
            yAxis: {
              title: {
                text: '%'
              }
            },
            legend: {
              reversed: true
            },
            plotOptions: {
              series: {
                stacking: 'normal',
                dataLabels: {
                  enabled: true,
                  format: '{y}%'
                }
              }
            },
            series: [ {
              name: 'Not Good',
              data: chartData.map(caste => Number(caste.data[0])),
              color: 'red'
            },
            {
              name: 'Good',
              data: chartData.map(caste => Number(caste.data[1])),
              color: 'green'
            }]
          });
          // Calculate total count for result2
        const result2TotalCount = castData2.reduce((total, d) => total + d['totalFactor'], 0);

        // Create a pie chart for result2
        const result2PieData = castData2.map(d => {
          let color;
          switch (d['CM_Satisfaction']) {
            case 'Good':
              color = 'green';
              break;
            case 'Not Good':
              color = 'red';
            
          }
          return {
            name: d['CM_Satisfaction'],
            y: (d['totalFactor'] / result2TotalCount) * 100,
            color: color
          };
        });

        Highcharts.chart(chartContainer1, {
          chart: {
            type: 'pie',
            backgroundColor: 'transparent',
            width: 450,
            height: 600
          },
          title: {
            text: 'CM SATISFACTION Total%'
          },
          plotOptions: {
            pie: {
              allowPointSelect: true,
              cursor: 'pointer',
              dataLabels: {
                enabled: true,
                format: '{point.name}: {point.percentage:.0f}%',
                formatter: function() {
                  return this.point.name + ': ' + this.point.percentage.toFixed(0) + '%'; // Add percentage directly to the data label
                }
              },
              tooltip: {
                pointFormat: '{point.name}: <b>{point.percentage:.0f}%</b>',
              }
            }
          },
          series: [{
            data: result2PieData
          }]
        });
        } else {
          console.log('Data is not an object or is empty:', castData);
          resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
        }
      } catch (error) {
        console.error(error);
      }
      finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
      }
    }

    // TDP + JSP Alliance  

    const TDP_JSP_Alliance = document.querySelector('#TDPJSPAlliance-btn');
    TDP_JSP_Alliance.addEventListener('click', renderTDPJSPAlliance);

    async function renderTDPJSPAlliance(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);
      try {
        // Call the TDP_JSP_Alliance endpoint to get the data for the pie charts
        const TDPJSPResponse = await axios.post('/TDP_JSP_Alliance', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const TDPJSPData = TDPJSPResponse.data;
        console.log(TDPJSPData);

        // Extract the data for TDP and JSP
        const TDPData = TDPJSPData.result.find(d => d.Party === 'TDP');
        const JSPData = TDPJSPData.result.find(d => d.Party === 'JSP');
        // Extract the data for result2
        const result2Data = TDPJSPData.result2;
        console.log(result2Data)

        // Extract the data for result3
        const result3Data = TDPJSPData.result3;
        console.log(result3Data)

        // Create the chart container
        let chartContainer = document.getElementById('chart-container');
        if (!chartContainer) {
          chartContainer = document.createElement('div');
          chartContainer.id = 'chart-container';
          chartContainer.style.display = 'flex';
          chartContainer.style.flexDirection = 'row';
          chartContainer.style.width = '100%';
          chartContainer.style.height = '50%';
          // resultContainer.style.marginleft='10px'
          resultContainer.appendChild(chartContainer);
        }
        // Create the chart container
        let chartContainer1 = document.getElementById('chart-container1');
        if (!chartContainer1) {
          chartContainer1 = document.createElement('div');
          chartContainer1.id = 'chart-container1';
          chartContainer1.style.display = 'flex';
          chartContainer1.style.flexDirection = 'row';
          chartContainer1.style.width = '100%';
          chartContainer1.style.height = '100%';
          // resultContainer.style.marginleft='10px'
          resultContainer.appendChild(chartContainer1);
        }

        // Create the chart containers for TDP and JSP
        let chartContainerTDP = document.createElement('div');
        chartContainerTDP.id = 'chart-container-tdp';
        chartContainerTDP.style.width = '50%';
        chartContainerTDP.style.height = '100%';
        chartContainer.appendChild(chartContainerTDP);

        let chartContainerJSP = document.createElement('div');
        chartContainerJSP.style.width = '50%';
        chartContainerJSP.style.height = '100%';
        chartContainerJSP.id = 'chart-container-jsp';
        chartContainer.appendChild(chartContainerJSP);

        let chartContainerJSPFull = document.createElement('div');
        chartContainerJSPFull.style.width = '50%';
        chartContainerJSPFull.style.height = '50%';
        chartContainerJSPFull.id = 'chart-container-jspfull';
        chartContainer1.appendChild(chartContainerJSPFull);


        let chartContainerTDPFull = document.createElement('div');
        chartContainerTDPFull.style.width = '50%';
        chartContainerTDPFull.style.height = '50%';
        chartContainerTDPFull.id = 'chart-container-tdpfull';
        chartContainer1.appendChild(chartContainerTDPFull);

        // Render the TDP pie chart
        Highcharts.chart(chartContainerTDP, {
          chart: {
            type: 'pie',
            width: 650,
            height: 300
          },
          title: {
            text: 'TDP Voters preference on alliance '
          },
          plotOptions: {
            pie: {
              // innerSize: '50%',
              // distance: -30,
              dataLabels: {
                enabled: true,
                format: '{point.name}: {point.percentage:.1f}%'
              }
            }
          },
          series: [{
            data: [{
              name: 'YSRCP',
              y: parseFloat(TDPData.YSRCP.replace('%', ''))
            }, {
              name: 'Will Not Vote',
              y: parseFloat(TDPData['Will Not Vote'].replace('%', ''))
            }, {
              name: 'TDP+JSP',
              y: parseFloat(TDPData['TDP+JSP'].replace('%', ''))
            }],
            colors: ['#ff6384', '#36a2eb', '#ffce56']
          }]
        });

        // Render the JSP pie chart
        Highcharts.chart(chartContainerJSP, {
          chart: {
            type: 'pie',
            width: 650,
            height: 300
          },
          title: {
            text: 'JSP Voters preference on alliance '
          },
          plotOptions: {
            pie: {
              // innerSize: '50%',
              // distance: -30,
              dataLabels: {
                enabled: true,
                format: '{point.name}: {point.percentage:.1f}%'
              }
            }
          },
          series: [{
            data: [{
              name: 'YSRCP',
              y: parseFloat(JSPData.YSRCP.replace('%', ''))
            }, {
              name: 'Will Not Vote',
              y: parseFloat(JSPData['Will Not Vote'].replace('%', ''))
            }, {
              name: 'TDP+JSP',
              y: parseFloat(JSPData['TDP+JSP'].replace('%', ''))
            }],
            colors: ['#ff6384', '#36a2eb', '#ffce56']
          }]
        });

        // Calculate total count for result2
        const result2TotalCount = result2Data.reduce((total, d) => total + d['COUNT(*)'], 0);

        // Create a pie chart for result2
        const result2PieData = result2Data.map(d => ({
          name: d['TDP Full'],
          y: (d['COUNT(*)'] / result2TotalCount) * 100
        }));

        Highcharts.chart('chart-container-jspfull', {
          chart: {
            type: 'pie',
            width: 650,
            height: 300
          },
          title: {
            text: 'TDP FULL'
          },
          series: [{
            data: result2PieData
          }]
        });


        // Calculate total count for result3
        const result3TotalCount = result3Data.reduce((total, d) => total + d['COUNT(*)'], 0);

        // Create a pie chart for result3
        const result3PieData = result3Data.map(d => ({
          name: d['JSP Full'],
          y: (d['COUNT(*)'] / result3TotalCount) * 100
        }));

        Highcharts.chart('chart-container-tdpfull', {
          chart: {
            type: 'pie',
            width: 650,
            height: 300
          },
          title: {
            text: 'JSP FULL'
          },
          series: [{
            data: result3PieData
          }]
        });

      } catch (error) {
        console.error(error);
        resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
      }
      finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }



    // prefferd YSRCP COORDINATOR  CANDIDATE
    const PrefferYSRCPCoordinator = document.querySelector('#PrefferYSRCPCoordinator-btn');
    PrefferYSRCPCoordinator.addEventListener('click', renderPrefferYSRCPCoordinator);

    async function renderPrefferYSRCPCoordinator(e) {
      const selectedDistrict = districtDropdown.value;
      const selectedConstituency = constituencyDropdown.value;
      const selectedWeek = weekDropdown.value;
      resultContainer.innerHTML = '';
      if (!selectedDistrict || !selectedConstituency || !selectedWeek) {
        resultContainer.innerHTML = '<p>Please select all dropdowns to get the data.</p>';
        return;
      }
      e.preventDefault()
      // Add a loader to the page
      const loader = document.createElement("div");
      loader.classList.add("loader");
      loader.style.position = "fixed";
      loader.style.top = "35%";
      loader.style.left = "55%";
      loader.style.transform = "translate(-50%, -50%)";
      loader.style.border = "25px solid rgba(0, 0, 0, 0.1)";
      loader.style.borderTopColor = "#3498db";
      loader.style.borderRadius = "75%";
      loader.style.width = "250px";
      loader.style.height = "250px";
      loader.style.animation = "spin 1s ease-in-out infinite";
      //   const text = document.createElement("span");
      // text.textContent = "Loading data";
      // text.style.position = "absolute";
      // text.style.top = "50%";
      // text.style.left = "50%";
      // text.style.transform = "translate(-50%, -50%)";
      // text.style.fontSize = "20px";
      // text.style.fontWeight = "bold";
      // loader.appendChild(text);

      document.body.appendChild(loader);

      try {
        // Call the PrefferdCaste endpoint to get the data for the pie chart
        const castResponse = await axios.post('/PrefferYSRCPCoordinator', { district: selectedDistrict, constituency: selectedConstituency, Date: selectedWeek });
        const castData = castResponse.data;

        if (castData && Object.keys(castData).length > 0) {
  // create an array of objects to store data for the pie chart
  const chartData = [];
  castData.forEach((item) => {
    let color;
    if (item["YSRCP Co-ordinator"] === "Same Co-ordinator") {
      color = 'rgb(1, 169, 91)';
    } else if (item["YSRCP Co-ordinator"] === "Anyone") {
      color = 'rgb(0, 119, 112)';
    } else if (item["YSRCP Co-ordinator"] === "Other Co-ordinator") {
      color = 'rgb(68, 114, 196)';
    }
    chartData.push({
      name: item["YSRCP Co-ordinator"],
      y: parseFloat(item["totalFactor_percentage"].replace('%', '')),
      color: color // add color property
    });
  });

  //  Create the chart container if it doesn't exist
  let chartContainer = document.getElementById('chart-container');
  if (!chartContainer) {
    chartContainer = document.createElement('div');
    chartContainer.id = 'chart-container';
    resultContainer.appendChild(chartContainer);
  }
  Highcharts.chart(chartContainer, {
    chart: {
      plotBackgroundColor: null,
      plotBorderWidth: null,
      plotShadow: false,
      type: 'pie'
    },
    title: {
      text: 'YSRCP Co-ordinator Chart'
    },
    tooltip: {
      pointFormat: '{series.name}: <b>{point.percentage:.0f}%</b>' // Update pointFormat to remove decimal
    },
    plotOptions: {
      pie: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: {
          enabled: true,
          format: '<b>{point.name}</b>: {point.percentage:.0f} %' // Update format to remove decimal
        }
      }
    },
    series: [{
      name: 'Preference Percentage',
      colorByPoint: true,
      data: chartData
    }],
    colors: [
      'rgb(1, 169, 91)', // Same MLA
      'rgb(0, 119, 112)', // Other MLA
      'rgb(68, 114, 196)' // Anyone
    ]
  });
        } else {
          // console.log('Data is not an object or is empty:', castData);
          // resultContainer.innerHTML = '<p>No data found. Please try again.</p>';
          renderPrefferMLAcandidate()
        }
      } catch (error) {
        console.error(error);
      }
      finally {
    // Remove the loader from the page
    document.body.removeChild(loader);
  }
    }



  </script>


</body>

</html>